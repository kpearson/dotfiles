# Minimal zshrc with Starship
# Optimized for performance while maintaining functionality
# zmodload zsh/zprof

export LC_CTYPE=C
export LANG=C
export DOTFILES="$HOME/.dotfiles"
export EDITOR=nvim

# Essential environment variables
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock

### Executables paths
export PATH="$DOTFILES/bin:$PATH"
export PATH="$HOME/.bin:$PATH"
export PATH="/usr/local/opt/qt@5.5/bin:$PATH"
export PATH="/usr/local/opt/openssl/bin:$PATH"

# Custom Aliases
[ -s "$DOTFILES/aliases" ] && . "$DOTFILES/aliases"
[ -s "$DOTFILES/aliases" ] || print "$DOTFILES/aliases not found."

# Homebrew config - Must come before any reference to Homebrew managed apps
eval "$(/opt/homebrew/bin/brew shellenv)"

# Direnv zsh config
eval "$(direnv hook zsh)"

# Git config
git config --global core.excludesfile "$DOTFILES/git/gitignore"

# Starship prompt (fast initialization)
export STARSHIP_CONFIG="$DOTFILES/shell/starship.toml"
eval "$(starship init zsh)"

# Essential zsh plugins via Homebrew (much faster than oh-my-zsh)
[ -f /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh ] && source /opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh
[ -f /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ] && source /opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# iTerm2 integration
[ -s "${HOME}/.iterm2_shell_integration.zsh" ] && . "${HOME}/.iterm2_shell_integration.zsh"

# tabtab source for packages (Currently serverless framework)
[[ -f ~/.config/tabtab/__tabtab.zsh ]] && . ~/.config/tabtab/__tabtab.zsh || true

# 1Password plugin config
[ -s "$HOME/.config/op/plugins.sh" ] && source "$HOME/.config/op/plugins.sh"

# asdf-vm - Manage multiple runtime versions
export ASDF_DATA_DIR="$HOME/.asdf"
export PATH="$ASDF_DATA_DIR/shims:$PATH"

# Docker
export DOCKER_DEFAULT_PLATFORM=linux/amd64

export COMPOSE_BAKE=true

# Zsh configuration for better UX
autoload -Uz compinit && compinit -C  # -C flag skips security check for faster startup
setopt AUTO_CD                    # cd without typing cd
setopt CORRECT                    # spell correction for commands
setopt EXTENDED_GLOB              # extended globbing

# History configuration (much better than oh-my-zsh defaults)
HISTSIZE=50000
SAVEHIST=50000
HISTFILE=~/.zsh_history
setopt EXTENDED_HISTORY           # Write the history file in the ':start:elapsed;command' format
setopt INC_APPEND_HISTORY         # Write to the history file immediately, not when the shell exits
setopt SHARE_HISTORY              # Share history between all sessions
setopt HIST_EXPIRE_DUPS_FIRST     # Expire duplicate entries first when trimming history
setopt HIST_IGNORE_DUPS           # Don't record an entry that was just recorded again
setopt HIST_IGNORE_ALL_DUPS       # Delete old recorded entry if new entry is a duplicate
setopt HIST_FIND_NO_DUPS          # Do not display a line previously found
setopt HIST_IGNORE_SPACE          # Don't record an entry starting with a space
setopt HIST_SAVE_NO_DUPS          # Don't write duplicate entries in the history file
setopt HIST_REDUCE_BLANKS         # Remove superfluous blanks before recording entry

# Better completion system
zstyle ':completion:*' menu select
zstyle ':completion:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|=*' 'l:|=* r:|=*'
zstyle ':completion:*' list-colors ''
zstyle ':completion:*:*:*:*:processes' command "ps -u $USER -o pid,user,comm -w -w"

# Key bindings
bindkey '^R' history-incremental-search-backward
bindkey '^[[A' history-search-backward      # Up arrow
bindkey '^[[B' history-search-forward       # Down arrow

# Enable basic completions
autoload -U +X bashcompinit && bashcompinit

# Optional: uncomment to profile startup time
# zprof 